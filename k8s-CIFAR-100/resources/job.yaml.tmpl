apiVersion: v1
kind: ConfigMap
metadata:
  name: training-script-cifar-100
data:
  train.py: |
<<<TRAINING_SCRIPT>>>
---
apiVersion: batch/v1
kind: Job
metadata:
  name: training-cifar-100
spec:
  template:
    spec:
      # Use the correct GKE label found in the node's YAML output
      nodeSelector:
        cloud.google.com/gke-accelerator: nvidia-l4
      containers:
      - name: training-container
        image: tensorflow/tensorflow:2.15.0-gpu
        command: ["python", "/script/train.py"]
        volumeMounts:
        - name: training-script-volume
          mountPath: /script
        resources:
          limits:
            nvidia.com/gpu: 1
      volumes:
      - name: training-script-volume
        configMap:
          name: training-script-cifar-100
      restartPolicy: OnFailure
  backoffLimit: 4